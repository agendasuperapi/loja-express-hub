<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /

  # 1. Não reescreve se for arquivo ou pasta real (incluindo assets)
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]
  
  # Permitir acesso direto a arquivos estáticos (assets, imagens, etc)
  RewriteCond %{REQUEST_URI} \.(js|css|png|jpg|jpeg|gif|svg|ico|woff|woff2|ttf|eot|json|map)$ [NC]
  RewriteRule ^ - [L]

  # 2. Regras de reescrita para BOTs de rede social (Meta Tags)
  # Verifica se é um bot E se a URL corresponde aos padrões de compartilhamento
  
  # /p/short_id (produtos) - para bots
  RewriteCond %{HTTP_USER_AGENT} (facebookexternalhit|Facebot|WhatsApp|Twitterbot|LinkedInBot|Slackbot|TelegramBot|Telegram|Discordbot|instagram|Googlebot|bingbot|crawler|spider) [NC]
  RewriteRule ^p/([a-zA-Z0-9_-]+)$ share.php?tipo=produto&id=$1 [QSA,L]

  # /nomedaloja (lojas) - para bots (exclui rotas comuns do React e arquivos)
  RewriteCond %{HTTP_USER_AGENT} (facebookexternalhit|Facebot|WhatsApp|Twitterbot|LinkedInBot|Slackbot|TelegramBot|Telegram|Discordbot|instagram|Googlebot|bingbot|crawler|spider) [NC]
  RewriteCond %{REQUEST_URI} !^/(dashboard|login|profile|cart|orders|admin|auth|forgot-password|reset-password|become-partner|store-details|product-page|not-found|api|assets|dist|src|node_modules|public) [NC]
  RewriteCond %{REQUEST_URI} !\.(php|html|css|js|json|png|jpg|jpeg|gif|svg|ico|woff|woff2|ttf|eot)$ [NC]
  RewriteRule ^([a-zA-Z0-9_-]+)$ share.php?tipo=loja&username=$1 [QSA,L]

  # 3. Todo o resto -> app web (SPA)
  RewriteRule ^.*$ /index.html [L]
</IfModule>

# Configuração de Headers (opcional, mas recomendada)
<IfModule mod_headers.c>
  Header set X-Frame-Options "SAMEORIGIN"
</IfModule>
